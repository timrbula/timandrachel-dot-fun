// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Guest {
  id                String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  name              String
  email             String   @unique
  allowPlusOne      Boolean  @default(false) @map("allow_plus_one")
  maxGuests         Int      @default(1) @map("max_guests")
  invitationSent    Boolean  @default(false) @map("invitation_sent")
  invitationSentAt  DateTime? @map("invitation_sent_at") @db.Timestamptz(6)
  notes             String?
  rsvps             RSVP[]

  @@index([email], map: "idx_guests_email")
  @@index([name], map: "idx_guests_name")
  @@map("guests")
}

model RSVP {
  id                     String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  createdAt              DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  guestId                String?  @map("guest_id") @db.Uuid
  guestName              String   @map("guest_name")
  guestEmail             String   @map("guest_email")
  attending              Boolean
  plusOne                Boolean  @default(false) @map("plus_one")
  plusOneName            String?  @map("plus_one_name")
  dietaryRestrictions    String?  @map("dietary_restrictions")
  songRequests           String?  @map("song_requests")
  specialAccommodations  String?  @map("special_accommodations")
  numberOfGuests         Int      @default(1) @map("number_of_guests")
  guest                  Guest?   @relation(fields: [guestId], references: [id], onDelete: SetNull)

  @@index([guestEmail], map: "idx_rsvps_email")
  @@index([guestId], map: "idx_rsvps_guest_id")
  @@index([createdAt(sort: Desc)], map: "idx_rsvps_created_at")
  @@map("rsvps")
}

model Guestbook {
  id        String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  name      String
  message   String
  location  String?

  @@index([createdAt(sort: Desc)], map: "idx_guestbook_created_at")
  @@map("guestbook")
}

model VisitorCount {
  id          Int      @id @default(1)
  count       Int      @default(0)
  lastUpdated DateTime @default(now()) @map("last_updated") @db.Timestamptz(6)

  @@map("visitor_count")
}

model GameScore {
  id        String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  name      String
  score     Int
  
  @@index([score(sort: Desc)], map: "idx_game_scores_score")
  @@index([createdAt(sort: Desc)], map: "idx_game_scores_created_at")
  @@map("game_scores")
}

model RSVPModificationToken {
  id        String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email     String   @map("email")
  token     String   @unique
  expiresAt DateTime @map("expires_at") @db.Timestamptz(6)
  used      Boolean  @default(false)
  usedAt    DateTime? @map("used_at") @db.Timestamptz(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")

  @@index([token], map: "idx_rsvp_tokens_token")
  @@index([email], map: "idx_rsvp_tokens_email")
  @@index([expiresAt], map: "idx_rsvp_tokens_expires")
  @@index([createdAt], map: "idx_rsvp_tokens_created")
  @@map("rsvp_modification_tokens")
}
